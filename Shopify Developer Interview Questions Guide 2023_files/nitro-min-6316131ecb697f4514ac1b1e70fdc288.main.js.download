jQuery.fn.bindFirst=function(e,r){this.on(e,r);var i=this.data("events")||jQuery._data(this[0],"events");var a=i[e];var n=a.splice(a.length-1)[0];a.splice(0,0,n)};var Rainmaker=function(){};Rainmaker.prototype={init:function(e){if(jQuery(e).closest(".rainmaker_form").length<1)return;if(jQuery(e).closest(".rainmaker_form").hasClass("rm_init_done"))return;if(jQuery(e).find(".rm_required_field, .ig_form_required_field").length<1){jQuery(e).append('<div style="position:absolute; left: -5000px"><input type="text" class="rm_required_field" value="" tabindex="-1"/></div>')}jQuery(e).closest(".rainmaker_form").addClass(jQuery(e).closest(".rainmaker_form").data("type")||"");jQuery(e).bindFirst("submit",function(e){window.rainmaker.addLead(e,jQuery(e.target))});jQuery(e).closest(".rainmaker_form").addClass("rm_init_done")},addLead:function(e,r,i){var r=r||undefined;if(typeof r!=="undefined"){if(jQuery(r).closest(".rainmaker_form").length<1)return;var i=i||undefined;var a=r.closest(".rainmaker_form");jQuery(a).find(".rm-loader").show();jQuery(a).find(".rm_button").attr("disabled",true);var n=jQuery(r).find('input[name="_mc4wp_form_id"]')&&jQuery(r).find('input[name="_mc4wp_form_id"]').length>0;if(!jQuery(a).hasClass("rm_custom")||!jQuery(r).attr("action")&&!n){e.preventDefault()}if(jQuery(r).find(".rm_required_field").val()||jQuery(r).find(".ig_form_required_field").val()){jQuery(a).find(".rm-loader").hide();r.slideUp("slow");jQuery(a).find("div.rm_form_message").show();return}var t={};var t=window.rainmaker.prepareFormData(e,r,i,t);action=rm_pre_data.ajax_url+"?action=rm_rainmaker_add_lead";jQuery(r).trigger("add_lead.rm",[t]);jQuery.ajax({type:"POST",url:action,data:t,dataType:"json",success:function(e){if(e&&typeof e.error!=="undefined"&&e.error!==""){jQuery(a).find(".rm-loader").hide();jQuery(a).find("div.rm_form_error_message").text(e.error).show();jQuery(window).trigger("error.rm",[r,e])}else if(e&&typeof e.success!=="undefined"){jQuery(r)[0].reset();jQuery(r).trigger("success.rm",[r,e]);jQuery(a).find(".rm-loader").hide();form_message=jQuery(a).next("div.rm_form_message").html();if(typeof form_message!=="undefined"&&form_message.trim()!==""){jQuery(a).slideUp("slow");jQuery(a).next("div.rm_form_message").show()}var i=e.redirection_url||"";i=i.trim();if(typeof i==="string"&&i!=""){if(!/^https?:\/\//i.test(i)){i="http://"+i}setTimeout(function(){window.location.href=i},200)}}else{jQuery(a).find(".rm-loader").hide()}},error:function(e){jQuery(a).find(".rm-loader").hide();console.log(e)}})}},prepareFormData:function(e,r,i,a){jQuery.each(jQuery(r).serializeArray()||{},function(e,r){a["rmfpx_"+r.name]=r.value});a["rmfpx_added"]=true;a["rmfpx_rm_nonce_field"]=rm_pre_data.rm_nonce_field;a["rmfpx_rm_form-id"]=jQuery(r.closest(".rainmaker_form")).data("form-id");if(typeof icegram!=="undefined"){a["rmfpx_ig_mode"]=icegram.mode;a["rmfpx_ig_remote_url"]=window.location.href;if(typeof i==="undefined"){var n=(jQuery(r.closest("[id^=icegram_message_]")||{}).attr("id")||"").split("_").pop()||0;i=icegram.get_message_by_id(n)||{}}if(typeof i.data!=="undefined"){a["rmfpx_ig_message_id"]=i.data.id;a["rmfpx_ig_campaign_id"]=i.data.campaign_id}}return a}};if(typeof window.rainmaker==="undefined"){window.rainmaker=new Rainmaker}jQuery(document).ready(function(){jQuery(".rainmaker_form form").each(function(e,r){window.rainmaker.init(r)})});jQuery(window).on("init.icegram",function(e,r){if(typeof r!=="undefined"&&typeof r.messages!=="undefined"){jQuery.each(r.messages,function(e,r){var i=jQuery(r.el).find(".rainmaker_form form");i.each(function(e,r){if(!jQuery(r).hasClass("rm_init_done")){window.rainmaker.init(r);jQuery(r).addClass("rm_init_done")}})})}});jQuery(window).off("success.rm");jQuery(window).on("success.rm",function(e,r,i){if(typeof icegram!=="undefined"){var a=((jQuery(e.target).closest("[id^=icegram_message_]")||{}).attr("id")||"").split("_").pop()||0;var n=icegram.get_message_by_id(a)||undefined;if(typeof n!=="undefined"){if(n.data.cta==="form_via_ajax"&&n.el.find(".rm_subscription, .rm_contact").length>0){n.el.trigger("form_success.ig_cta",[n])}else if(n.data.cta==="form"||!n.data.cta){if(n.data.use_form==undefined){n.data.response_text=""}response_text='<div class="ig_form_response_text">'+(n.data.response_text||n.el.find(".rm_form_message").html()||"")+"</div>";n.el.find(".ig_form_container, .ig_message, .ig_headline").hide();var t=n.el.filter(".ig_container");if(jQuery.inArray(n.data.type,["interstitial","messenger"])!==-1){t=n.el.find(".ig_message");t.show();n.el.find(".ig_headline").text("").show()}else if(n.data.type==="tab"){t=n.el.find(".ig_data");n.el.find(".ig_headline").show()}try{t.append(response_text)}catch(e){console.log(e)}}}}});jQuery(window).off("form_submit.ig_cta");jQuery(window).on("form_submit.ig_cta",window.rainmaker.addLead);